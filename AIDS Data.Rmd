---
title: "AIDS Data Analysis: Rough Draft"
author: "Jack Hanley"
date: "April 26, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE, fig.height=2.75, fig.width=4.5, fig.align = "center")
library(tidyverse)

library(readr)
library(broom)
library(ggpubr)
library(boot)

# For Analysis

library(survival)
library(survminer)

options(digits=5)
```


```{r Data Input, include = F, }

aids <- read_csv("AIDSdata.csv")

# Change from M => 1, F => 2 to 
#             M => 0, F => 1


aids <- aids %>%
    mutate(sex=replace(sex, which(sex ==1),0 )) %>%
    mutate(sex=replace(sex, which(sex ==2),1 )) %>%
    as.data.frame()

aids <- aids %>%
    mutate(raceth=replace(raceth, which(raceth == 1), "White Non-Hispanic" )) %>%
    mutate(raceth=replace(raceth, which(raceth == 2), "Black Non-Hispanic" )) %>%
    mutate(raceth=replace(raceth, which(raceth == 3), "Hispanic" )) %>%
    mutate(raceth=replace(raceth, which(raceth == 4), "Asian Pacific Islander" )) %>%
    mutate(raceth=replace(raceth, which(raceth == 5), "American Indian" )) %>%
    mutate(raceth=replace(raceth, which(raceth == 6), "Other" )) %>%
    as.data.frame()
aids$raceth <- as.factor(aids$raceth)

aids <-  aids %>% arrange(id)
  

```

```{r Exploratory Data Analysis}

summary(aids)

aids %>% ggplot() +
  geom_bar( aes(x = as.factor(raceth))) +
  xlab('Race') +
  theme(axis.text.x=element_text(angle = -45, hjust = 0))



aids %>% ggplot(aes(x = time_d, y = ..density..)) +
  geom_histogram(bins = 25) +
  geom_density(col = 'red', lwd = 2, alpha = 0.5)



aids %>% ggplot(aes(x = karnof)) +
  geom_bar()+
  ggtitle('Health of Individuals: Karnofsky Scores')

# The health of the majority of the individuals of the dataset


aids %>% ggplot(aes(x = karnof, y = time_d))+
  geom_point()

ggboxplot(data = aids,x = "karnof", y = "time_d", color = "karnof", palette = c("red","blue", "darkgreen", "orange"),  xlab = "", ylab = "Time to Death") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  geom_hline(yintercept = mean(aids$time_d), col = "black", lwd = 1, lty = 'dashed') # dashed line is man time-to-death



```

It looks like the data is dominated by white, hispanic, and black individuals.
A basic histogram also reveals that the chance of dying seems to increase
exponentially over time.

Regardless of initial Karnofsky score, the time to death distributions seem fairly similar.
Additionally, all karnof-score mean time-to-deaths are above the total dataset time-to-death.


```{r Data Cleaning}

for( x in c(1:9,11:dim(aids)[2]) ){
  
  title = colnames(aids)[x]
  
  hist(aids[,x], main = title)
  
  
}


```

Notes: 

- Even though `txgrp` is listed as having 4 possible indicators, only two indicators, the ones for ZDV + 3TC and ZDV + 3TC + IDV, are used

- $84.25$% of participants in the study are male

- At time of entering study, no particpant claimed to be currently using IV drugs (only "Never" or "Previous")

- 

```{r Preliminary Modeling}

fit1 <- 

```


```{r ROC/AUC Analysis}

library(verification)

# roc.area(obs, pred)

```

```{r Possible Boosting via Concordance Index}



```


```{r Something New: Bootstrap}

# Prelim Code : https://thestatsgeek.com/2013/07/02/the-miracle-of-the-bootstrap/

# bs <- boot(data, func, R = 5000  stype)


```

#Something New

Topic: Bootstrapping the Survival Model

Bootstrapping is essentially the resampling with replacement of our data. Although we have a decently large sample size of 851, we have very few Asian or American Indian representatives. To be able to make inferences from our bootstrapped samples, we need our current sample to be a random sample from the population we want to make inferences about. With 851 subjects, we are also in a great position to effectively bootstrap. By bootstrapping to increase our sample size we will hope to have a more representative dataset to model on; this will ideally reduce the standard errors of our survival model. 

Although I do have some experience learning about bootstrapping through MATH 152: Statistical Theory, I have never implemented a bootsrapping algorithm. When learning to apply a new statistical concept, it can be challenging to deal with roadblocks and coding issues. Since it's new, you may not know troubleshooting sources. This further stresses the importance and value of finding reliable resources, both to learn the initial concept and to help deal with any potential roadblocks that may come up.

Possible Resources:

Functions like `censboot` in the `boot` package (documentatino for `boot` package)

General bootstraping:

https://www.statmethods.net/advstats/bootstrapping.html




